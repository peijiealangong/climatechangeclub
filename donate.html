<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-68D6N5XQ6D"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-68D6N5XQ6D');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Support climate action by donating to the Climate Change Club. Every contribution helps drive impactful environmental initiatives.">

    <title>Climate Change Club | Donate</title>
    <link rel="stylesheet" href="style.css">
    <script src="javascript.js"></script>
</head>
<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5DKK3SNG"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <!-- Navigation Bar -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="projects.html">Our Projects</a></li>
            <li><a href="meetings.html">Meetings</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="donate.html">Donate</a></li>
        </ul>
    </nav>

    <!-- Donation Section -->
    <header>
        <h1>Support the Climate Change Club</h1>
        <p>Your donation helps us fund environmental initiatives! üåçüíö</p>
    </header>

    <section id="donate">
        <h2>üíö Enter Your Donation Amount</h2>
        <form id="donation-form">
            <label for="amount">Donation Amount ($):</label>
            <input type="number" id="amount" min="1" step="1" required>
            <button type="submit" id="apple-pay-button" style="display:none;">Donate with Apple Pay</button>
        </form>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Climate Change Club | All Rights Reserved</p>
    </footer>

    <script>
        // Check if Apple Pay is supported
        if (window.ApplePaySession && ApplePaySession.canMakePayments()) {
            document.getElementById('apple-pay-button').style.display = 'block';
        } else {
            alert("Apple Pay is not supported on this device. You can still view this page when you hit OK, but you cannot submit donations using Apple Pay.");
        }

        document.getElementById('donation-form').addEventListener('submit', (event) => {
            event.preventDefault();
            const amount = document.getElementById('amount').value;

            if (!amount || amount < 1) {
                alert("Please enter a valid donation amount.");
                return;
            }

            const paymentRequest = {
                countryCode: 'US',
                currencyCode: 'USD',
                total: {
                    label: 'Climate Change Club Donation',
                    amount: amount
                },
                supportedNetworks: ['visa', 'masterCard', 'amex'],
                merchantCapabilities: ['supports3DS']
            };

            const session = new ApplePaySession(3, paymentRequest);

            session.onvalidatemerchant = (event) => {
                fetch('/validate-merchant', {
                    method: 'POST',
                    body: JSON.stringify({ validationURL: event.validationURL })
                })
                .then(response => response.json())
                .then(merchantSession => session.completeMerchantValidation(merchantSession))
                .catch(error => console.error('Merchant validation failed', error));
            };

            session.onpaymentauthorized = (event) => {
                fetch('/process-payment', {
                    method: 'POST',
                    body: JSON.stringify(event.payment)
                })
                .then(response => response.json())
                .then(result => {
                    if(result.success){
                        session.completePayment(ApplePaySession.STATUS_SUCCESS);
                        alert(`‚úÖ Thank you for donating $${amount}! Your support makes a difference. üåçüíö`);
                    } else {
                        session.completePayment(ApplePaySession.STATUS_FAILURE);
                        alert("‚ùå Payment failed. Please try again.");
                    }
                })
                .catch(error => {
                    session.completePayment(ApplePaySession.STATUS_FAILURE);
                    console.error("Payment processing failed", error);
                });
            };

            session.begin();
        });
    </script>

</body>
</html>